---
parameters:
  - name: goal
    type: string
    default: package
    displayName: Maven goal to run
  - name: testResultsFiles
    type: string
    default: '**/surefire-reports/TEST-*.xml' 
    displayName: Test results file
  - name: specificVersion
    type: string
    default: ''
    displayName: specific version of maven 
  - name: artifactsPath
    type: string
    default: '**/*.jar'
    displayName: Artifacts Path

    
steps:
  - task: maven@4
    inputs: 
      mavenPOMFile: pom.xml
      goals: ${{ parameters.goal }}
      publishJUnitResults: true
      testResultsFiles: ${{ parameters.testResultsFiles }}
    condition: eq('${{ parameters.specificVersion }}','')

  - task: maven@4
    inputs: 
      mavenPOMFile: pom.xml
      goals: ${{ parameters.goal }}
      publishJUnitResults: true
      testResultsFiles: ${{ parameters.testResultsFiles }}
      jdkVersionOption: ${{ parameters.specificVersion }}
    condition: ne('${{ parameters.specificVersion }}','')

  - task: CopyFiles@2
    inputs:
      contents: $(parameters.artifactsPath)
      targetFolder: $(Build.ArtifactStagingDirectory)

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: $(Build.ArtifactStagingDirectory)
      artifactName: $(Build.Repository.Name)